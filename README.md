Архитектура и назначение проекта
Проект — это веб‑система для автоматизации обработки заявлений на ГПЗУ. Серверная часть на FastAPI предоставляет набор модулей (Kaiten, MID/MIF, ТУ, ГПЗУ, Отказы, MapInfo workspace) и общие парсеры. Фронтенд на React строит защищённые маршруты и интерфейс для запуска этих модулей и просмотра журналов (БД). В продакшене backend умеет раздавать собранный React‑билд как статический фронтенд.

Backend (FastAPI)
1) Центральное приложение и маршруты
backend/main.py создаёт FastAPI‑приложение, включает CORS, регистрирует роутеры модулей и при старте инициализирует БД. Также монтирует фронтенд‑билд и статические файлы (если собраны).

2) Аутентификация
Аутентификация реализована HTTP Basic; учётные данные берутся из файла backend/users.txt. Эндпойнт /api/auth/me используется для проверки входа, /api/auth/logout — для выхода.

3) Общие парсеры
Модуль /api/parsers предоставляет:

/application — парсит заявление из DOCX и возвращает поля (номер, дата, заявитель, кадастр, телефон, email).

/egrn — парсит XML ЕГРН и возвращает кадастр, адрес, площадь, координаты.

/spatial — выполняет пространственный анализ по координатам и кадастровому номеру.

/health — проверка здоровья модуля.

4) Модули работы с ГПЗУ
Kaiten

/api/gp/kaiten/parse-application — парсинг заявления.

/api/gp/kaiten/create-task — создание карточки в Kaiten и запись в БД (модель Application).

MID/MIF

/api/gp/midmif/preview — предпросмотр координат ЕГРН в формате X=восток, Y=север.

/api/gp/midmif/generate — генерация ZIP с MID/MIF файлами.

Технические условия (ТУ)

/api/gp/tu/parse-application и /parse-egrn — парсинг заявления и ЕГРН.

/api/gp/tu/generate — генерация пакета документов ТУ (ZIP), с поддержкой JSON и form‑формата запросов.

Градплан (ГПЗУ)

/api/gp/gradplan/generate — генерация DOCX градплана по шаблону, запись в БД.

/api/gp/gradplan/download/{filename} — скачивание сформированного документа.

/api/gp/gradplan/spatial-analysis — пространственный анализ участка.

/api/gp/gradplan/health — проверка здоровья модуля.

Отказ

/api/gp/refusal/generate — формирование DOCX‑отказа по шаблону причин, с записью в БД и передачей сообщения через заголовки.

/api/gp/refusal/reasons — список причин отказа.

/api/gp/refusal/health — проверка здоровья модуля.

MapInfo Workspace

/api/gp/workspace/create — принимает ЕГРН, выполняет пространственный анализ, генерирует MIF/MID, конвертирует в TAB, формирует WOR и возвращает ZIP. Эндпойнт защищён Basic‑Auth (берёт ФИО пользователя).

База данных и журналы
1) Настройка БД
Используется SQLAlchemy и PostgreSQL. init_db() создаёт таблицы моделей Application, GP, Refusal, TuRequest.

2) Модели
Application — данные заявлений (номер, дата, заявитель, кадастр, статус).

GP — записи о выданных градпланах и их реквизитах.

Refusal — журнал отказов (исходящие реквизиты, причина, вложение).

TuRequest — журнал запросов ТУ, с типами РСО и вложениями.

3) CRUD‑эндпойнты
/api/gp/applications — CRUD и фильтрация заявлений по кадастру/статусу.

/api/gp/refusals — CRUD отказов, загрузка вложений, экспорт в Excel.

/api/gp/tu-requests — CRUD запросов ТУ, вложения, экспорт, справочник РСО.

Frontend (React)
1) Маршрутизация и защита
App.js настраивает маршруты. Компонент ProtectedRoute проверяет авторизацию через /api/auth/me; при ошибке сбрасывает localStorage и отправляет на /login.

2) Логин
LoginForm сохраняет логин/пароль в localStorage и вызывает authApi.checkAuth() (Basic‑Auth через axios).

3) Главные страницы
GP.jsx — страница модулей (Kaiten, MID/MIF, ТУ, ГПЗУ, Отказ, Workspace) и переход к журналам.

Journals.jsx — вкладки для журналов заявлений, градпланов, отказов и запросов ТУ.

4) API‑клиент
services/api.js:

вычисляет базовый URL,

добавляет Basic‑Auth из localStorage,

описывает API для парсеров и всех модулей (Kaiten/MIDMIF/TU/Gradplan/Refusal/Workspace).

5) Таблицы журналов
Например, ApplicationsTable запрашивает /api/gp/applications, показывает фильтры по статусу и кадастровому номеру, и отрисовывает таблицу заявлений.